{% extends "base.html" %}
{% load static %}

{% block head_title_extra %} Edit Recipe {% endblock %}

{% block content %}
{% load crispy_forms_tags %}

<div class="container">

    <div class="row">
        <div class="col-12 text-center p-2">
            <h1>Edit Recipe</h1>
        </div>
    </div>

    <div class="row">
        <div class="col-12">
            <form method="post" enctype="multipart/form-data">
                {% csrf_token %}
                {{ recipe_form | crispy }}
                <br>
                <h3>Ingredients:</h3>
                {{ ingredients_formset.management_form }}
                <div id="ingredient-list">
                    {% for form in ingredients_formset %}
                    <div class="ingredient-form">
                        {{ form |crispy }}
                    </div>
                    {% endfor %}
                </div>
                

                <!-- for additional ingredients -->
                <div id="new-ingredient-form" class="visually-hidden">
                    {{ ingredients_formset.empty_form |crispy }}
                    <button id="new-delete-ingredient-button" class="delete-ingredient btn btn-outline-danger my-2" type="button">Delete Ingredient</button>
                </div>
                <button id="add-ingredient" class="btn btn-outline-secondary my-2" type="button">Add An Ingredient</button>

                <br>
                <h3>Method:</h3>
                {{ method_formset.management_form }}
                <div id="method-list">
                    {% for form in method_formset %}
                    <div class="method-form">
                        {{ form |crispy }}
                    </div>
                    {% endfor %}
                </div>

                <!-- for additional method steps -->
                <div id="new-method-form" class="visually-hidden">
                    {{ ingredients_formset.empty_form |crispy }}
                    <button id="new-delete-method-button" class="delete-method btn btn-outline-danger my-2" type="button">Delete Step</button>
                </div>
                <button id="add-method" class="btn btn-outline-secondary my-2" type="button">Add A Step</button>

                
                <a class="btn btn-secondary float-end" href="{% url 'home' %}" role="button">Cancel</a>
                <a class="btn btn-danger float-end mx-2" href="{% url 'delete_recipe' recipe.id %}" role="button">Delete</a>
                <button class="btn btn-success float-end" type="submit">Save</button>
            </form>
        </div>
    </div>

    <div class="row">
        <div class="col-12 text-center text-muted">
            <p>Recipe's are made Private by default. An Admin can allow your recipe to be Public.</p>
        </div>
    </div>

    <!-- hidden div for checking existing tags -->
    {% if recipe.tags.all %}
    {% for tag in recipe.tags.all %}
    <div class="d-none existing-tag">
        {{ tag.id }}
    </div>
    {% endfor %}
    {% endif %}

</div>

<!-- JS for adding/deleting Ingredent items and Method steps -->
<!-- CREDIT for JavaScript for adding ingredients and div structure for new forms: CodingEntrepreneurs' Youtube Video https://youtu.be/s3T-w2jhDHE I adapted the way that new item/step ids were created so that duplicate ids wouldnt be created after an item/step was deleted and added custom JavaScript for the delete button functionality -->
<script src="{% static 'js/script.js' %}"></script>

{% endblock %}